<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <title>Healthy Heaven</title>

    {{{_sections.css}}}
    <link rel="stylesheet" href="/public/css/global.css">
</head>

<body>
    <div id="header">
        <div class="container-fluid" style="position: relative;">
            <div class="container auth_row">
                <div class="header__navbar-item pt-3  main__information">
                    <a class="can-hover btnsellerPage" href="/admin">
                        <i class="bi bi-person"></i>
                        Seller page
                    </a>

                    {{#if auth}}
                    <div class="dropdown ml-5">
                        <button class="dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false"
                            style="background-color: transparent; color:#fff;border:none;">
                            Hello, <b>{{authAccount.username}}</b>
                        </button>
                        <div class="dropdown-menu">
                            <button class="dropdown-item" type="button">
                                <a class="" href="/buyer_info">
                                    <i class="bi bi-person"></i>
                                    Profile
                                </a>
                            </button>
                            <button class="dropdown-item" type="button">
                                <a class="" href="/buyer_info/order">
                                    <i class="bi bi-card-list"></i>
                                    Purchase
                                </a>
                            </button>

                            <button class="dropdown-item" type="button">
                                <form id="frmLogout" action="/account/logout" method="post"></form>
                                <a class="" href="javascript: $('#frmLogout').submit()">
                                    <i class="bi bi-box-arrow-right"></i>
                                    Sign out
                                </a>
                            </button>
                        </div>
                    </div>
                    {{else}}

                    <a class="can-hover btnSignIn " href="/account/login">
                        <img src="/public/images/icons-signin.png" alt="" class="">
                        Sign in
                    </a>
                    <a class="can-hover btnSignup" href="/account/register">
                        <img src="/public/images/icons8-signup.png" alt="" class="">
                        Sign up
                    </a>
                    {{/if}}
                </div>
            </div>
            <form id="frmSearch" action="/product/list/byName" method="post">

                <div class="header__navbar container">
                    <div class="logoPic" style="width: 120px; margin-right: 32px;">
                        <a href="/">
                            <img src="/public/images/LogoHea.png" alt="" style="width: 100%;">
                        </a>
                    </div>
                    <div class="header__navbar-item header__search-bar">
                        <span class="">
                            <i class="bi bi-search spanSearchIcon mr-3"></i>
                        </span>
                        <input id="txtSearchText" type="text" placeholder="Input product name ..." name="text">
                        <button class="can-hover btnSearch">
                            <a href="javascript: $('#frmSearch').submit()" style="text-decoration: none; color: black;">
                                Search
                            </a>
                        </button>
                    </div>
                    <div class="header__navbar-item header__cart can-hover">
                        <button type="button">
                            <a href="/cart" style="text-decoration: none; color: #fff;">
                                <img src="/public/images/icons8-cart-24 (2).png" alt=""> Cart
                            </a>
                        </button>
                    </div>
                </div>
            </form>
            <div class="supportive_info_container d-flex container">
                <div class="supportive_infor">
                    <img src="/public/images/icons8-product-24.png" alt="">
                    100% original products
                </div>
                <div class="supportive_infor">
                    <img src="/public/images/icons8-in-transit-24.png" alt="">
                    Free shipping at HCM city
                </div>
                <div class="supportive_infor">
                    <img src="/public/images/icons8-money-24.png" alt="">
                    Return within 15 days
                </div>
            </div>
        </div>
    </div>

    <div id="content">
        {{{body}}}
    </div>

    <div id="footer" style="margin-top: 100px;">
        <hr class="customSeparateLine">
        <div class="container-fluid">
            <div class="row logoFooter">
                <a href="" class="col-3">
                    <img src="/public/images/LogoHea.png" alt="" width="70%">
                </a>
                <div class="col-9">
                    <div class="footer__title-list row">
                        <div class="col-4">About us</div>
                        <div class="col-4 title_policyInfo">Policy</div>
                        <div class="col-4 title_contactInfo">Contact</div>
                    </div>
                    <div class="row">
                        <div class="storeInfor col-4">
                            <ul>
                                <li>
                                    <a href="">Introduction about the store</a>
                                </li>
                                <li>
                                    <a href="">F&Q</a>
                                </li>
                                <li>
                                    <a href="">Our story</a>
                                </li>
                            </ul>
                        </div>
                        <div class="policyInfor col-4">
                            <ul class="ul_policyInfo">
                                <li>
                                    <a href="">Delivery Policy</a>
                                </li>
                                <li>
                                    <a href="">Payment Policy</a>
                                </li>
                                <li>
                                    <a href="">Member Policy</a>
                                </li>
                            </ul>
                        </div>
                        <div class="contactInfor col-4">
                            <ul>
                                <li>
                                    Hotline:
                                    <span id="txtPhone"> 0112356789</span>
                                </li>
                                <li class="links-box">
                                    Website:
                                    <span id="txtPhone"> healthyheaven.com</span>
                                </li>
                                <li>
                                    Address:
                                    <span id="txtAddress"> 5/3 112 Phước Long A, Quận 9</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            {{!-- <div class="row d-flex justify-content-center">
            </div> --}}

        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.querySelectorAll('.btn-add').forEach(button => {
            button.addEventListener('click', function () {
                const formId = this.getAttribute('data-form-id');
                const form = document.getElementById(formId);

                // Kiểm tra xem form có tồn tại không
                if (!form) {
                    console.error('Form không tìm thấy:', formId);
                    return;
                }

                // Lấy dữ liệu từ form
                const formData = new FormData(form);

                // Chuyển đổi FormData thành đối tượng JavaScript
                const formObject = {};
                formData.forEach((value, key) => {
                    formObject[key] = value;
                });

                console.log(JSON.stringify(formObject));

                // Gửi dữ liệu qua fetch với JSON
                fetch(form.action, {
                    method: form.method,
                    body: JSON.stringify(formObject),  // Chuyển đối tượng thành chuỗi JSON
                    headers: {
                        'Content-Type': 'application/json'  // Đảm bảo gửi dưới dạng JSON
                    }
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Lỗi HTTP! Mã trạng thái: ${response.status}`);
                        }
                        return response.json();  // Chuyển đổi phản hồi thành JSON
                    })
                    .then(data => {
                        console.log(data);  // Kiểm tra dữ liệu trả về từ server
                        if (data.success) {
                            // Hiển thị thông báo thành công
                            Swal.fire({
                                title: 'Thành công!',
                                text: data.message,
                                icon: 'success',
                                confirmButtonText: 'OK'
                            });

                            // Cập nhật giỏ hàng với số lượng items và tổng tiền
                            if (document.getElementById('totalItems')) {
                                document.getElementById('totalItems').textContent = data.totalItems;
                            }
                            if (document.getElementById('cartTotal')) {
                                document.getElementById('cartTotal').textContent = formatPrice(data.cartTotal);
                            }
                        } else {
                            // Hiển thị thông báo lỗi nếu không thành công
                            Swal.fire({
                                title: 'Lỗi!',
                                text: data.message,
                                icon: 'error',
                                confirmButtonText: 'OK'
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Lỗi khi lấy dữ liệu:', error);
                        Swal.fire({
                            title: 'Lỗi!',
                            text: 'Có lỗi xảy ra khi thêm sản phẩm vào giỏ hàng.',
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                    });
            });
        });

        // Hàm định dạng giá tiền
        function formatPrice(price) {
            return numeral(price).format('0,0') + ' VNĐ';  // Định dạng theo kiểu số VNĐ
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"
        integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+"
        crossorigin="anonymous"></script>
    {{{_sections.js}}}
</body>

</html>